<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Nesting &mdash; Meta 1.0.0 documentation</title>
    
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.0.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/translations.js"></script>
    <link rel="top" title="Meta 1.0.0 documentation" href="index.html" />
    <link rel="next" title="Union" href="union.html" />
    <link rel="prev" title="Tuple" href="tuple.html" />
   
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body role="document">  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="nesting">
<h1>Nesting<a class="headerlink" href="#nesting" title="제목 주소">¶</a></h1>
<p>Entity 를 다른 Entity 의 정의에 사용하는 방법을 살펴본다.</p>
<div class="section" id="embedding">
<h2>Embedding<a class="headerlink" href="#embedding" title="제목 주소">¶</a></h2>
<p>사용자가 새로 정의한 Entity 역시 Property 다. 때문에 특별한 준비 없이 Entity 정의에 사용할 수 있다.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">Author</span><span class="p">(</span><span class="n">meta</span><span class="o">.</span><span class="n">Entity</span><span class="p">):</span>
<span class="gp">... </span>   <span class="n">name</span> <span class="o">=</span> <span class="n">meta</span><span class="o">.</span><span class="n">String</span><span class="p">()</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">Book</span><span class="p">(</span><span class="n">meta</span><span class="o">.</span><span class="n">Entity</span><span class="p">):</span>
<span class="gp">... </span>   <span class="n">title</span> <span class="o">=</span> <span class="n">meta</span><span class="o">.</span><span class="n">String</span><span class="p">()</span>
<span class="gp">... </span>   <span class="n">published</span> <span class="o">=</span> <span class="n">meta</span><span class="o">.</span><span class="n">Date</span><span class="p">()</span>
<span class="gp">... </span>   <span class="n">author</span> <span class="o">=</span> <span class="n">Author</span><span class="p">()</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">book</span> <span class="o">=</span> <span class="n">Book</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">book</span><span class="o">.</span><span class="n">author</span> <span class="o">=</span> <span class="n">Author</span><span class="p">({</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;O&#39;</span><span class="p">})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">book</span>
<span class="go">Book(dict(author=Author(dict(name=&#39;O&#39;))))</span>
</pre></div>
</div>
<p>직렬화 하면 Entity 에 포함된 Entity 들 역시 직열화된다.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">book</span><span class="o">.</span><span class="n">dump</span><span class="p">()</span>
<span class="go">{&#39;author&#39;: {&#39;name&#39;: &#39;O&#39;}}</span>
</pre></div>
</div>
<p>반대도 역시 성립한다.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">book</span> <span class="o">=</span> <span class="n">Book</span><span class="p">()</span><span class="o">.</span><span class="n">load</span><span class="p">({</span><span class="s1">&#39;author&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;O&#39;</span><span class="p">}})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">book</span>
<span class="go">Book(dict(author=Author(dict(name=&#39;O&#39;))))</span>
</pre></div>
</div>
<p>Entity 에 내장된 Entity 는 데이터를 직접 대입해도 된다.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">book</span><span class="o">.</span><span class="n">author</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;O&#39;</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">book</span><span class="o">.</span><span class="n">author</span>
<span class="go">Author(dict(name=&#39;O&#39;))</span>
</pre></div>
</div>
</div>
<div class="section" id="circular-reference">
<h2>Circular Reference<a class="headerlink" href="#circular-reference" title="제목 주소">¶</a></h2>
<p>자기 자신을 Property 로 갖는 자료 구조를 생각해보자.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">Tree</span><span class="p">(</span><span class="n">meta</span><span class="o">.</span><span class="n">Entity</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">children</span> <span class="o">=</span> <span class="n">Tree</span><span class="p">[:]()</span> 
<span class="gt">Traceback (most recent call last):</span>
    <span class="o">...</span>
<span class="gr">NameError</span>: <span class="n">... &#39;Tree&#39; is not defined</span>
</pre></div>
</div>
<p>클래스 정의가 완료되기 전에는 그 이름이 정의되지 않은 상태기 때문에 <a class="reference external" href="http://docs.python.org/3/library/exceptions.html#NameError" title="(in Python v3.5)"><code class="xref py py-exc docutils literal"><span class="pre">NameError</span></code></a> 예외가 발생한다.</p>
<p>이 문제를 해결하기 위해 <code class="docutils literal"><span class="pre">&#64;declare</span></code> 데코레이터를 제공한다.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nd">@meta.declare</span>
<span class="gp">... </span><span class="k">class</span> <span class="nc">Tree</span><span class="p">:</span> <span class="k">pass</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">Tree</span><span class="p">(</span><span class="n">meta</span><span class="o">.</span><span class="n">Entity</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">children</span> <span class="o">=</span> <span class="n">Tree</span><span class="p">[:]()</span>
</pre></div>
</div>
<p>클래스를 <code class="docutils literal"><span class="pre">&#64;declare</span></code> 로 선언해주면, Meta 는 같은 이름의 Entity 를 뒤에 정의하겠다는 뜻으로 받아들인다.
이 때 <code class="docutils literal"><span class="pre">&#64;declare</span></code> 로 선언해주는 클래스는 이름만 중요할뿐 그 내용은 신경쓰지 않는다.
이제 <code class="docutils literal"><span class="pre">Tree</span></code> 라는 이름을 <code class="docutils literal"><span class="pre">Tree</span></code> 정의에 사용할 수 있게된다.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">tree</span> <span class="o">=</span> <span class="n">Tree</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tree</span><span class="o">.</span><span class="n">children</span> <span class="o">=</span> <span class="p">[</span><span class="n">Tree</span><span class="p">(),</span> <span class="n">Tree</span><span class="p">()]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tree</span>
<span class="go">Tree(dict(children=(Tree(), Tree())))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tree</span><span class="o">.</span><span class="n">dump</span><span class="p">()</span>
<span class="go">{&#39;children&#39;: [{}, {}]}</span>
</pre></div>
</div>
<p>이런 상황은 꼭 자기 자신을 참조하는 경우만 발생하지는 않는다.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nd">@meta.declare</span>
<span class="gp">... </span><span class="k">class</span> <span class="nc">Child</span><span class="p">:</span> <span class="k">pass</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">Mother</span><span class="p">(</span><span class="n">meta</span><span class="o">.</span><span class="n">Entity</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">children</span> <span class="o">=</span> <span class="n">Child</span><span class="p">[:]()</span>
<span class="gp">...</span>
</pre></div>
</div>
<p>만약 <code class="docutils literal"><span class="pre">&#64;declare</span></code> 한 Entity 의 정의를 제공하겠다는 약속을 지키지 않아도, 그 Entity 가 필요한 순간이 오기 전에는 문제를 일으키지 않는다.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">mother</span> <span class="o">=</span> <span class="n">Mother</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mother</span><span class="o">.</span><span class="n">children</span> <span class="o">=</span> <span class="p">[]</span>
</pre></div>
</div>
<p>하지만 필요한 시점이 오면 <a class="reference external" href="http://docs.python.org/3/library/exceptions.html#ReferenceError" title="(in Python v3.5)"><code class="xref py py-exc docutils literal"><span class="pre">ReferenceError</span></code></a> 예외를 일으킨다.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">mother</span><span class="o">.</span><span class="n">children</span> <span class="o">=</span> <span class="p">[{}]</span>
<span class="gt">Traceback (most recent call last):</span>
    <span class="o">...</span>
<span class="gr">ReferenceError</span>: <span class="n">unresolved class __main__.Child</span>
</pre></div>
</div>
<p>약속을 이행하면 문제가 해결된다.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">Child</span><span class="p">(</span><span class="n">meta</span><span class="o">.</span><span class="n">Entity</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">mother</span> <span class="o">=</span> <span class="n">Mother</span><span class="p">()</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mother</span><span class="o">.</span><span class="n">children</span> <span class="o">=</span> <span class="p">[{}]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mother</span>
<span class="go">Mother(dict(children=(Child(),)))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mother</span><span class="o">.</span><span class="n">dump</span><span class="p">()</span>
<span class="go">{&#39;children&#39;: [{}]}</span>
</pre></div>
</div>
</div>
<div class="section" id="hiding-properties">
<h2>Hiding Properties<a class="headerlink" href="#hiding-properties" title="제목 주소">¶</a></h2>
<p>앞에서 예로 든 <code class="docutils literal"><span class="pre">Mother</span></code> 와 <code class="docutils literal"><span class="pre">Child</span></code> 의 구조는 실용적이지 않다. 그 의미상 클래스 구조 뿐만 아니라 인스턴스 역시 상호 참조해야 하기 때문이다.
만약 <code class="docutils literal"><span class="pre">Child</span></code> 의 <code class="docutils literal"><span class="pre">mother</span></code> 에 값을 주고 직렬화 한다면 무한 순환에 빠지게 된다.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">child</span> <span class="o">=</span> <span class="n">Child</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">child</span><span class="o">.</span><span class="n">mother</span> <span class="o">=</span> <span class="n">mother</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mother</span><span class="o">.</span><span class="n">children</span> <span class="o">=</span> <span class="p">[</span><span class="n">child</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mother</span><span class="o">.</span><span class="n">dump</span><span class="p">()</span>
<span class="gt">Traceback (most recent call last):</span>
    <span class="o">...</span>
<span class="gr">OverflowError</span>
</pre></div>
</div>
<p>이처럼 Entity 인스턴스가 순환 참조되는 경우 <a class="reference external" href="http://docs.python.org/3/library/exceptions.html#OverflowError" title="(in Python v3.5)"><code class="xref py py-exc docutils literal"><span class="pre">OverflowError</span></code></a> 예외를 일으킨다.</p>
<p>이런 무한 순환을 막는 방법중 하나는, Entity 를 특정할 수 있는 속성을 도입하고, 어느 한쪽에서 순환 고리를 끊는 것이다.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nd">@meta.declare</span>
<span class="gp">... </span><span class="k">class</span> <span class="nc">Child</span><span class="p">:</span> <span class="k">pass</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">Mother</span><span class="p">(</span><span class="n">meta</span><span class="o">.</span><span class="n">Entity</span><span class="p">):</span>
<span class="gp">... </span>    <span class="nb">id</span> <span class="o">=</span> <span class="n">meta</span><span class="o">.</span><span class="n">String</span><span class="p">()</span>
<span class="gp">... </span>    <span class="n">children</span> <span class="o">=</span> <span class="n">Child</span><span class="p">[:]()</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">Child</span><span class="p">(</span><span class="n">meta</span><span class="o">.</span><span class="n">Entity</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">mother</span> <span class="o">=</span> <span class="n">Mother</span><span class="p">(</span><span class="n">only</span><span class="o">=</span><span class="s1">&#39;id&#39;</span><span class="p">)</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mother</span> <span class="o">=</span> <span class="n">Mother</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mother</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="s1">&#39;1234&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">child</span> <span class="o">=</span> <span class="n">Child</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mother</span><span class="o">.</span><span class="n">children</span> <span class="o">=</span> <span class="p">[</span><span class="n">child</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">child</span><span class="o">.</span><span class="n">mother</span> <span class="o">=</span> <span class="n">mother</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pprint</span><span class="p">(</span><span class="n">mother</span><span class="o">.</span><span class="n">dump</span><span class="p">())</span>
<span class="go">{&#39;children&#39;: [{&#39;mother&#39;: {&#39;id&#39;: &#39;1234&#39;}}], &#39;id&#39;: &#39;1234&#39;}</span>
</pre></div>
</div>
<p>Entity 에 제공할 수 있는 <code class="docutils literal"><span class="pre">only</span></code> 라는 옵션은,
지정한 속성들(<a class="reference external" href="http://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.5)"><code class="xref py py-class docutils literal"><span class="pre">list</span></code></a> 를 줄 수 있다)을 제외한 모든 속성들을 직렬화에 포함시키지 않도록 만든다.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">목차</a></h3>
  <ul>
<li><a class="reference internal" href="#">Nesting</a><ul>
<li><a class="reference internal" href="#embedding">Embedding</a></li>
<li><a class="reference internal" href="#circular-reference">Circular Reference</a></li>
<li><a class="reference internal" href="#hiding-properties">Hiding Properties</a></li>
</ul>
</li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="tuple.html" title="이전 장">Tuple</a></li>
      <li>Next: <a href="union.html" title="다음 장">Union</a></li>
  </ul></li>
</ul>
</div>
  <div role="note" aria-label="source link">
    <h3>현재 문서</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/nesting.txt"
            rel="nofollow">소스 코드를 보려면</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>빠른 검색</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="바로 가기" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    모듈, 클래스 또는 함수 이름을 입력하십시오.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;Flowdas Inc.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.3.6</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.7</a>
      
      |
      <a href="_sources/nesting.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>